<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MSK Special Tests â€” Drag & Match</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0c0f1e; --bg2:#0a0d1a; --card:#171c3a; --border:#2a3160;
    --muted:#9aa4bf; --ink:#eaf0ff; --ok:#33d17a; --bad:#ff6b6b;
    --acc1:#8b7cff; --acc2:#00d1ff; --acc3:#ffc36b;
    --shadow: 0 8px 28px rgba(5,8,28,.35);
  }
  *{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
  html,body{height:100%}
  body{
    margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,Helvetica,sans-serif;
    background: radial-gradient(1200px 800px at 10% -10%, #12163a 0%, #0c0f1e 45%, #0a0d1a 100%);
    color:var(--ink);
    -webkit-user-select:none; user-select:none;
  }

  .wrap{
    max-width:1200px; margin:0 auto; padding:24px 16px 40px;
    display:flex; flex-direction:column; gap:18px;
  }

  header{
    position:sticky; top:0; z-index:5;
    background:linear-gradient(180deg, rgba(12,15,30,1), rgba(12,15,30,.85), rgba(12,15,30,0));
    backdrop-filter:saturate(1.1) blur(4px);
    padding-bottom:6px;
    display:flex; gap:14px; align-items:flex-start; justify-content:space-between;
  }
  .title h1{
    margin:0; font-size: clamp(22px, 3.5vw, 34px); letter-spacing:.2px;
    background: linear-gradient(90deg,var(--acc1),var(--acc2),var(--acc3));
    -webkit-background-clip:text; background-clip:text; color:transparent;
  }
  .title p{margin:.25rem 0 0; color:var(--muted); font-size:14px}

  .controls{
    display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:flex-end;
  }
  button{
    appearance:none; border:1px solid var(--border); background:var(--card);
    color:var(--ink); padding:12px 14px; border-radius:12px; font-weight:700;
    cursor:pointer; box-shadow:var(--shadow); transition:transform .06s ease, border-color .2s ease;
    touch-action:manipulation;
  }
  button:hover{ transform:translateY(-1px); border-color:#3b4591; }
  button:active{ transform:translateY(0); }
  .ghost{ opacity:.6 }

  .grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:16px;
    align-items:start;
  }

  .column{
    background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0));
    border:1px solid var(--border);
    border-radius:16px; padding:14px; box-shadow:var(--shadow);
    min-height:420px;
    display:flex; flex-direction:column; gap:12px;
    justify-content:flex-start; align-content:flex-start;
  }
  .column h2{
    margin:4px 4px 6px; font-size:16px; color:var(--muted); font-weight:700; letter-spacing:.3px;
  }

  .bank, .targets{
    display:flex; flex-direction:column; gap:10px;
    justify-content:flex-start; align-content:flex-start; align-items:stretch;
  }

  .card{
    border:1px solid var(--border); background:rgba(23,28,58,.92);
    border-radius:14px; padding:14px 14px; line-height:1.25;
    font-weight:800; user-select:none;
    box-shadow:var(--shadow);
    touch-action:none;           /* enables smooth pointer-drag on mobile */
  }
  .card[draggable="true"]{ cursor:grab; }
  .card.dragging{ opacity:.6; outline:2px dashed #4e59be; }

  .target{
    border:1px dashed #39407a; border-radius:14px; padding:10px; position:relative;
    min-height:64px; display:flex; align-items:center; justify-content:space-between; gap:10px;
    background:rgba(10,13,26,.6);
  }
  .target .label{
    font-weight:800; font-size:15px; color:#cad3f8;
  }
  .slot{
    flex:0 0 auto; min-width:210px; min-height:44px; border:1px solid #39407a; border-radius:12px;
    display:flex; align-items:center; justify-content:center; padding:6px 8px; color:var(--muted);
    background:rgba(19,23,47,.6)
  }
  .slot.filled{ border-style:solid; color:#9fb3ff; font-weight:700; }
  .target.over, .slot.over{ outline:2px dashed #6a74ff; outline-offset:2px }

  .badge{
    font-size:12px; font-weight:800; padding:6px 10px; border-radius:999px; border:1px solid var(--border);
    background:linear-gradient(90deg, rgba(139,124,255,.15), rgba(0,209,255,.15));
    color:#cfd7ff; letter-spacing:.3px; white-space:nowrap;
  }

  .footer{
    display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
    color:var(--muted); font-size:13px; padding-top:8px;
  }
  .score{ font-weight:800; color:#cfe6ff }
  .toast{
    position:fixed; inset:auto 16px 16px auto; z-index:50; padding:10px 14px; border-radius:12px;
    border:1px solid var(--border); background:var(--card); color:var(--ink); box-shadow:var(--shadow);
    display:none;
  }
  .toast.show{ display:block; }

  /* Mobile layout polish */
  @media (max-width: 900px){
    .grid{ grid-template-columns: 1fr; }
    .slot{ min-width:unset; width:100%; min-height:48px; }
    .target{ flex-wrap:wrap; gap:8px }
    .title p{ font-size:13px }
    .card{ font-size:15px; padding:16px }
  }

  /* Floating drag clone for touch */
  .drag-ghost{
    position:fixed; left:0; top:0; z-index:9999; pointer-events:none;
    transform:translate(-9999px,-9999px) scale(1.02);
    filter:drop-shadow(0 10px 22px rgba(0,0,0,.45));
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>MSK Special Tests â€” Drag &amp; Match</h1>
        <p>Drag a test from the left into the matching condition on the right. No hints. No sharing. Just skills.</p>
      </div>
      <div class="controls">
        <button id="shuffleBtn" title="Shuffle bank items">Shuffle</button>
        <button id="resetBtn" title="Reset everything">Reset</button>
        <button id="checkBtn" title="Check your matches">Check answers</button>
      </div>
    </header>

    <div class="grid" id="board" aria-live="polite">
      <!-- Bank -->
      <section class="column">
        <h2>Test Bank</h2>
        <div class="bank" id="bank" aria-label="Draggable tests"></div>
      </section>

      <!-- Targets -->
      <section class="column">
        <h2>Match to the Condition</h2>
        <div class="targets" id="targets" aria-label="Drop targets"></div>
      </section>
    </div>

    <div class="footer">
      <div class="badge">No hints â€¢ No class sharing</div>
      <div class="score" id="score">0 / 10 correct</div>
    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

<script>
(() => {
  // --- Dataset ---
  const PAIRS = [
    { id: "hawkins",   left: "Hawkinsâ€“Kennedy",              right: "Subacromial impingement" },
    { id: "emptycan",  left: "Empty Can (Jobe) Test",        right: "Supraspinatus tear/tendinopathy" },
    { id: "appreloc",  left: "Apprehension + Relocation",    right: "Anterior shoulder instability" },
    { id: "speeds",    left: "Speedâ€™s Test",                 right: "Long-head biceps tendinopathy" },
    { id: "finkel",    left: "Finkelstein Test",             right: "De Quervainâ€™s tenosynovitis" },
    { id: "phalen",    left: "Phalenâ€™s Test",                right: "Carpal tunnel syndrome" },
    { id: "lachman",   left: "Lachman Test",                 right: "ACL rupture" },
    { id: "mcmurray",  left: "McMurray Test",                right: "Meniscal tear" },
    { id: "thompson",  left: "Thompson Test",                right: "Achilles tendon rupture" },
    { id: "talar",     left: "Talar Tilt",                   right: "Lateral ankle instability (ATFL/CFL)" },
  ];

  // --- State ---
  let placed = {}; // targetId -> cardId
  let dragData = null;

  // --- Elements ---
  const bankEl    = document.getElementById('bank');
  const targetsEl = document.getElementById('targets');
  const scoreEl   = document.getElementById('score');
  const toastEl   = document.getElementById('toast');

  const shuffleBtn = document.getElementById('shuffleBtn');
  const resetBtn   = document.getElementById('resetBtn');
  const checkBtn   = document.getElementById('checkBtn');

  // --- Helpers ---
  const rand = (arr) => arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]);

  function showToast(msg, ms=1600){
    toastEl.textContent = msg;
    toastEl.classList.add('show');
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=> toastEl.classList.remove('show'), ms);
  }

  function makeCard(pair){
    const el = document.createElement('div');
    el.className = 'card';
    el.draggable = true;
    el.dataset.cardId = pair.id;
    el.textContent = pair.left;

    // Desktop drag events
    el.addEventListener('dragstart', e => {
      dragData = { type:'card', cardId: pair.id };
      el.classList.add('dragging');
      e.dataTransfer.setData('text/plain', pair.id);
      e.dataTransfer.effectAllowed = 'move';
    });
    el.addEventListener('dragend', () => {
      dragData = null;
      el.classList.remove('dragging');
    });

    // Touch/Pointer drag (mobile)
    enablePointerDrag(el, pair.id);
    return el;
  }

  function makeTarget(pair){
    const target = document.createElement('div');
    target.className = 'target';
    target.dataset.targetId = pair.id;

    const label = document.createElement('div');
    label.className = 'label';
    label.textContent = pair.right;

    const slot = document.createElement('div');
    slot.className = 'slot';
    slot.textContent = 'Drop test here';
    slot.dataset.accepts = pair.id;

    // DnD handlers for both target and slot (desktop)
    [target, slot].forEach(el=>{
      el.addEventListener('dragover', e => {
        if(!dragData || dragData.type!=='card') return;
        e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
        el.classList.add('over');
      });
      el.addEventListener('dragleave', () => el.classList.remove('over'));
      el.addEventListener('drop', e => {
        e.preventDefault();
        el.classList.remove('over');
        const cardId = e.dataTransfer.getData('text/plain') || (dragData && dragData.cardId);
        if(!cardId) return;
        placeCard(cardId, pair.id);
      });
    });

    target.appendChild(label);
    target.appendChild(slot);
    return target;
  }

  function render(){
    bankEl.innerHTML = '';
    targetsEl.innerHTML = '';
    placed = {};

    // Build bank (shuffled on load)
    const shuffled = rand(PAIRS.slice());
    shuffled.forEach(p => bankEl.appendChild(makeCard(p)));

    // Build targets (stable order)
    PAIRS.forEach(p => targetsEl.appendChild(makeTarget(p)));

    updateScore();
  }

  function placeCard(cardId, targetId){
    const cardEl = findCardEl(cardId);
    if(!cardEl) return;

    // Free previous placements of this card
    for (const [tId, cId] of Object.entries(placed)){
      if(cId === cardId){ clearSlot(tId); }
    }
    // If target already filled, return its card to the bank
    if (placed[targetId]) {
      returnCardToBank(placed[targetId]);
    }

    const slot = findSlotEl(targetId);
    slot.textContent = '';
    slot.classList.add('filled');
    slot.appendChild(cardEl);
    placed[targetId] = cardId;
    updateScore();
  }

  function clearSlot(targetId){
    const slot = findSlotEl(targetId);
    if(!slot) return;
    if(slot.firstElementChild){
      bankEl.appendChild(slot.firstElementChild);
    }
    slot.textContent = 'Drop test here';
    slot.classList.remove('filled');
    delete placed[targetId];
  }

  function returnCardToBank(cardId){
    const cardEl = findCardEl(cardId);
    if(!cardEl) return;
    bankEl.appendChild(cardEl);
    for (const [tId, cId] of Object.entries(placed)){
      if(cId === cardId){
        slotReset(tId);
        delete placed[tId];
        break;
      }
    }
    updateScore();
  }

  function slotReset(targetId){
    const slot = findSlotEl(targetId);
    if(slot){
      slot.textContent = 'Drop test here';
      slot.classList.remove('filled');
    }
  }

  function findCardEl(cardId){
    return document.querySelector(`.card[data-card-id="${cardId}"]`);
  }
  function findSlotEl(targetId){
    return document.querySelector(`.target[data-target-id="${targetId}"] .slot`);
  }

  function updateScore(){
    let correct = 0;
    for (const pair of PAIRS){
      if(placed[pair.id] === pair.id) correct++;
    }
    scoreEl.textContent = `${correct} / ${PAIRS.length} correct`;
  }

  // --- Controls ---
  shuffleBtn.addEventListener('click', () => {
    Object.keys(placed).forEach(clearSlot);
    const cards = [...bankEl.children];
    const shuffled = rand(cards);
    bankEl.innerHTML = '';
    shuffled.forEach(el => bankEl.appendChild(el));
    showToast('Shuffled the bank.');
  });

  resetBtn.addEventListener('click', () => {
    render();
    showToast('Board reset.');
  });

  checkBtn.addEventListener('click', () => {
    document.querySelectorAll('.target').forEach(t => {
      t.style.boxShadow = 'none';
      const tId = t.dataset.targetId;
      const ok = placed[tId] === tId;
      t.style.boxShadow = ok ? '0 0 0 2px inset rgba(51,209,122,.75)' : '0 0 0 2px inset rgba(255,107,107,.65)';
      setTimeout(() => t.style.boxShadow = 'none', 900);
    });

    const correct = Object.values(placed).filter((cardId, i) => {
      const targetId = Object.keys(placed)[i];
      return cardId === targetId;
    }).length;

    showToast(correct === PAIRS.length ? 'Perfect! ðŸŽ‰' : 'Keep going!');
  });

  // Allow returning a card to the bank by dropping it anywhere in the bank (desktop)
  bankEl.addEventListener('dragover', e => {
    if(!dragData || dragData.type!=='card') return;
    e.preventDefault();
    bankEl.classList.add('over');
  });
  bankEl.addEventListener('dragleave', () => bankEl.classList.remove('over'));
  bankEl.addEventListener('drop', e => {
    e.preventDefault();
    bankEl.classList.remove('over');
    const cardId = e.dataTransfer.getData('text/plain') || (dragData && dragData.cardId);
    if(!cardId) return;
    returnCardToBank(cardId);
  });

  // --- Touch/Pointer drag implementation ---
  function enablePointerDrag(cardEl, cardId){
    let ghost = null, startX=0, startY=0;

    const onPointerDown = (e) => {
      // Only left click / primary touch
      if(e.button !== undefined && e.button !== 0) return;
      cardEl.setPointerCapture?.(e.pointerId);
      e.preventDefault();

      // Create floating ghost
      ghost = cardEl.cloneNode(true);
      ghost.classList.add('drag-ghost');
      ghost.style.width = (cardEl.getBoundingClientRect().width) + 'px';
      document.body.appendChild(ghost);

      startX = e.clientX; startY = e.clientY;
      positionGhost(e.clientX, e.clientY);
      cardEl.classList.add('dragging');
      dragData = { type:'card', cardId };
    };

    const onPointerMove = (e) => {
      if(!ghost) return;
      positionGhost(e.clientX, e.clientY);

      // Visual highlight on potential drop zones
      const dropEl = getDropTargetAt(e.clientX, e.clientY);
      document.querySelectorAll('.target, .slot').forEach(el => el.classList.remove('over'));
      if(dropEl) dropEl.classList.add('over');
    };

    const onPointerUp = (e) => {
      if(!ghost) return;
      const dropEl = getDropTargetAt(e.clientX, e.clientY);
      cleanupDrag();

      if(dropEl){
        // Decide targetId from either .target or its parent
        const target = dropEl.classList.contains('target') ? dropEl : dropEl.closest('.target');
        if(target && target.dataset.targetId){
          placeCard(cardId, target.dataset.targetId);
          return;
        }
      }
      // No valid drop â†’ return to bank
      returnCardToBank(cardId);
    };

    function positionGhost(x,y){
      const offset = 18; // keep finger from covering label
      ghost.style.transform = `translate(${x+8}px, ${y-offset}px)`;
    }

    function getDropTargetAt(x,y){
      const el = document.elementFromPoint(x,y);
      if(!el) return null;
      return el.closest?.('.slot, .target') || null;
    }

    function cleanupDrag(){
      document.querySelectorAll('.target, .slot').forEach(el => el.classList.remove('over'));
      cardEl.classList.remove('dragging');
      dragData = null;
      if(ghost && ghost.parentNode) ghost.parentNode.removeChild(ghost);
      ghost = null;
    }

    // Attach listeners
    cardEl.addEventListener('pointerdown', onPointerDown);
    window.addEventListener('pointermove', onPointerMove);
    window.addEventListener('pointerup', onPointerUp);
    window.addEventListener('pointercancel', onPointerUp);
  }

  // Initial render (includes auto-shuffle of the bank)
  render();
})();
</script>
</body>
</html>
